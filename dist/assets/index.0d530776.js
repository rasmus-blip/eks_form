import{I as e}from"./vendor.9c77823e.js";const t={},r={};function o(e){const o=document.querySelectorAll(`#${e} fieldset`);r[e]=o.length,t[e]=0;document.querySelector(`#${e} .fieldset_slider`).style.width=100*r[e]+"%"}function n(e,o){const n=100/r[o];!0===e.classList.contains("next")?t[o]+=n:t[o]-=n;const c=document.querySelector(`#${o} .fieldset_slider`),a=`-${t[o]}%`;c.style.setProperty("--slide-distance",a)}const c={headersHeroku:{"Content-Type":"application/json"},headersRestDB:{"Content-Type":"application/json","x-apikey":"60740776f592f7113340ef9b","cache-control":"no-cache"}};async function a(e,t){const r=await fetch(e,{method:"get",headers:c[t]});return await r.json()}async function u(e,t,r){const o=JSON.stringify(e),n=await fetch(t,{method:"post",headers:c[r],body:o});return await n.json()}let s=[];async function d(){const e=await u(s,"https://foobarfirefjerdedele.herokuapp.com/order","headersHeroku");200===e.status?l(e.id):alert("Oupss, this i not how its supposed to work...")}async function l(e){const t=await a("https://foobarfirefjerdedele.herokuapp.com/","headersHeroku"),r=t.queue,o=t.serving.map((e=>e.id)),n=function(e,t){let r=0;return e.forEach((e=>{e.id<=t&&r++})),r}(r,e);n>0?(document.querySelector("#order_submitted span").textContent=n,document.querySelector("#order_submitted").classList.add("show"),setTimeout((()=>{l(e)}),1e3)):o.includes(e)?(document.querySelector("#order_submitted p").textContent="Your order is getting prepared.",document.querySelector("#order_submitted").classList.add("show"),setTimeout((()=>{l(e)}),1e3)):(document.querySelector("#order_submitted h2").textContent="Your order is ready",document.querySelector("#order_submitted p").remove(),document.querySelector("#order_submitted p").remove(),document.querySelector("#order_submitted").classList.add("show"))}let i=null;async function m(){this.removeEventListener("click",m),document.querySelector("#order_form .loading").classList.add("load"),document.querySelector("#order_form .loading p").textContent="Requesting sign in...";const e=document.querySelector("#username").value,t=document.querySelector("#password").value,r=await async function(e,t){const r=`https://frontendspring2021-a6f0.restdb.io/rest/foobar-user-database?q={"user_name": "${e}", "password": "${t}"}`,o=await a(r,"headersRestDB");return 0!==o.length&&o}(e,t);if(document.querySelector("#order_form .loading").classList.remove("load"),!1===r){this.addEventListener("click",m);const e=document.querySelector("#sign_in .error_span");e.textContent="Username or password not correct",e.classList.add("error");document.querySelectorAll("#sign_in input").forEach((t=>{t.addEventListener("click",(()=>{e.textContent="",e.classList.remove("error")}))}))}else y(r)}function y(e){i=e[0]?e[0]:e,console.log(e),document.querySelector("#sign_in").remove(),document.querySelector("#checkout").remove(),document.querySelector("#your_order .submit").style.display="block",document.querySelector("#your_order .next").style.display="none",document.querySelector("#order .back").style.display="none",o("order_form"),S()}function p(e){const t=function(e){if(""===e)return!1;const t=Number(e.replaceAll(" ",""));return!isNaN(t)&&t}(e.number),r=function(e){if(""===e)return!1;const t=e.indexOf("/"),r=Number(e.substring(0,t)),o=Number(e.substring(t+1)),n=new Date,c=n.getFullYear(),a=n.getMonth()+1;return!(isNaN(r)||isNaN(o)||r>12||o+2e3<c||o+2e3>c+3)&&!(o+2e3===c&&r<a)}(e.expDate),o=function(e){return!isNaN(e)&&""!==e}(e.cvv);return!!(t&&r&&o)}function q(){o("order_form"),document.querySelectorAll("button").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault()}))})),L("order_form"),function(){document.querySelector("#sign_in .submit").addEventListener("click",m);document.querySelector(".create_acc").addEventListener("click",(()=>{document.querySelector("body").style.transform="translateY(-100%)",document.querySelector("#account_form").hidden=!1}));document.querySelector(".no_sign_in").addEventListener("click",(e=>{S(),n(e.target,"order_form")}))}(),document.querySelector("#order .next").addEventListener("click",(e=>{const t=function(){const e=document.querySelectorAll("#order input");return s=[],e.forEach((e=>{if(e.value>0){const t={name:e.name,amount:e.value};s.push(t)}})),s}();!function(e){const t=document.querySelector("#order_container");t.innerHTML="";const r=document.querySelector("#order_temp");let o=0;e.forEach((e=>{const n=r.cloneNode(!0).content,c=f(e.name);n.querySelector("img").src=`./images/${c}.png`,n.querySelector("img").setAttribute("alt",e.name),n.querySelector("h2").textContent=e.name,n.querySelector("p").textContent=e.amount,t.appendChild(n),o+=40*e.amount})),document.querySelector("#your_order p span").textContent=o+"DKK",document.querySelector("#checkout")&&(document.querySelector("#checkout p span").textContent=o+"DKK")}(t),t.length>0?n(e.target,"order_form"):(document.querySelector("#order p").classList.remove("error"),document.querySelector("#order p").offsetHeight,document.querySelector("#order p").classList.add("error"))}));document.querySelector("#your_order .next").addEventListener("click",(e=>{n(e.target,"order_form")})),document.querySelector("#your_order .submit").addEventListener("click",_),document.querySelector("#checkout button").addEventListener("click",h)}async function S(){!function(e){const t=document.querySelector("#beer_container");t.innerHTML="";const r=document.querySelector("#beer_temp");e.forEach((e=>{const o=f(e.beer);if(null===document.querySelector(`#${o}`)){const n=r.cloneNode(!0).content;n.querySelector("img").src=`./images/${o}.png`,n.querySelector("img").setAttribute("alt",e.beer),n.querySelector("label").textContent=e.beer,n.querySelector("label").setAttribute("for",o),n.querySelector("input").setAttribute("id",o),n.querySelector("input").setAttribute("name",e.beer),n.querySelector(".minus").addEventListener("click",v),n.querySelector(".plus").addEventListener("click",v),t.appendChild(n)}}))}((await a("https://foobarfirefjerdedele.herokuapp.com/","headersHeroku")).taps)}function f(e){return e.replaceAll(" ","").toLowerCase()}function v(){const e=this.parentElement.querySelector("input");this.classList.contains("minus")&&e.value>=1?e.value--:this.classList.contains("plus")&&(e.value++,document.querySelector("#order p").classList.remove("error"))}function _(){this.removeEventListener("click",_);const e=i;console.log(e);const t={number:e.card_number,expDate:e.expiration_date,cvv:e.cvv};console.log(t);p(t)?d():(this.addEventListener("click",_),alert("Ouch.... are you trying to hack the system??"))}function h(){this.removeEventListener("click",h);if(p({number:document.querySelector('#checkout [name="card_number"]').value,expDate:document.querySelector('#checkout [name="exp_date" ]').value,cvv:document.querySelector('#checkout [name="cvv" ]').value}))d();else{document.querySelector("#checkout .top p").classList.remove("error"),document.querySelector("#checkout .top p").offsetHeight,document.querySelector("#checkout .top p").classList.add("error");document.querySelectorAll("#checkout input").forEach((e=>{e.addEventListener("click",(()=>document.querySelector("#checkout .top p").classList.remove("error")))})),this.addEventListener("click",h)}}function L(e){document.querySelectorAll(`#${e} .back`).forEach((t=>{t.addEventListener("click",(()=>{n(t,e)}))}))}async function k(e){if(function(){const e=document.querySelector("#username_create").checkValidity();!1===e&&(document.querySelector(".error_span.username").textContent="Username must be at least 4 characters",document.querySelector(".error_span.username").classList.add("error"),document.querySelector("#username_create").addEventListener("click",b));const t=document.querySelector("#email").checkValidity();!1===t&&(document.querySelector(".error_span.email").textContent="Please enter a valid email",document.querySelector(".error_span.email").classList.add("error"),document.querySelector("#email").addEventListener("click",b));const r=document.querySelector("#password_create").checkValidity();!1===r&&(document.querySelector(".error_span.password_create").textContent="Password must be at least 4 characters",document.querySelector(".error_span.password_create").classList.add("error"),document.querySelector("#password_create").addEventListener("click",b));const o=document.querySelector("#password_create").value,n=document.querySelector("#repeat_password").value,c=o===n;!1===c&&(document.querySelector(".error_span.password").textContent="Passwords are not identical",document.querySelector(".error_span.password").classList.add("error"),document.querySelector("#repeat_password").addEventListener("click",b));return!!(e&&t&&r&&c)}()){document.querySelector("#account_form .loading").classList.add("load"),document.querySelector("#account_form .loading p").textContent="Validating email and username...";const t=await async function(){const e=document.querySelector("#username_create").value,t=await g("user_name",e);!0===t&&(document.querySelector(".error_span.username").textContent="Username is already taken",document.querySelector(".error_span.username").classList.add("error"),document.querySelector("#username_create").addEventListener("click",b));const r=document.querySelector("#email").value,o=await g("email",r);!0===o&&(document.querySelector(".error_span.email").textContent="Email is not valid",document.querySelector(".error_span.email").classList.add("error"),document.querySelector("#email").addEventListener("click",b));return!1===t&&!1===o}();document.querySelector("#account_form .loading").classList.remove("load"),t&&n(e.target,"account_form")}}function b(){this.removeEventListener("click",b);const e=this.parentElement.parentElement.querySelector(".error");e.textContent="",e.classList.remove("error")}async function g(e,t){const r=`https://frontendspring2021-a6f0.restdb.io/rest/foobar-user-database?q={"${e}": "${t}"}`;return 1===(await a(r,"headersRestDB")).length}async function E(){this.removeEventListener("click",E);if(!1===p({number:document.querySelector('#card_details [name="card_number"]').value,expDate:document.querySelector('#card_details [name="exp_date" ]').value,cvv:document.querySelector('#card_details [name="cvv" ]').value})){document.querySelector("#card_details .top p").classList.remove("error"),document.querySelector("#card_details .top p").offsetHeight,document.querySelector("#card_details .top p").classList.add("error");document.querySelectorAll("#card_details input").forEach((e=>{e.addEventListener("click",(()=>document.querySelector("#card_details .top p").classList.remove("error")))})),this.addEventListener("click",E)}else{document.querySelector("#account_form .loading").classList.add("load"),document.querySelector("#account_form .loading p").textContent="Creating account...";const e=await async function(){const e={user_name:document.querySelector("#username_create").value,email:document.querySelector("#email").value,password:document.querySelector("#password_create").value,card_number:document.querySelector("#account_card_number").value,expiration_date:document.querySelector("#account_exp_date").value,cvv:document.querySelector("#account_cvv").value},t="https://frontendspring2021-a6f0.restdb.io/rest/foobar-user-database";return await u(e,t,"headersRestDB")}();document.querySelector("#account_form .loading").classList.remove("load"),e.status?(this.addEventListener("click",E),alert("Oups... something is not completely right... pls reload")):(!function(e){document.querySelector("#succes_screen span").textContent=e.user_name,document.querySelector("#succes_screen").classList.add("show")}(e),y(e),setTimeout((()=>{document.querySelector("body").style.transform="translateY(0)"}),3e3))}}function w(e){"Tab"==e.key&&setTimeout(x,1)}function x(){"stop"===document.querySelector(":focus").dataset.tab?document.addEventListener("keydown",C):document.removeEventListener("keydown",C)}function C(e){e.preventDefault(),e.target.parentElement.parentElement.querySelector("input").focus()}function A(){const e=(new Date).getHours();e>=18||e<=6?document.querySelector("body").classList.add("darkmode"):document.querySelector("body").classList.remove("darkmode")}window.addEventListener("DOMContentLoaded",(function(){A(),setInterval(A,5e3),document.addEventListener("keydown",w),document.addEventListener("keydown",(e=>{"Enter"===e.key&&e.preventDefault()}));const t=new e("9999 9999 9999 9999"),r=new e("99/99"),n=new e("999");document.querySelectorAll('[name="card_number"]').forEach((e=>{t.mask(e)}));document.querySelectorAll('[name="exp_date"]').forEach((e=>{r.mask(e)}));document.querySelectorAll('[name="cvv"]').forEach((e=>{n.mask(e)})),q(),o("account_form"),L("account_form"),document.querySelector("#account_details .next").addEventListener("click",k),document.querySelector("#card_details .submit").addEventListener("click",E)}));
